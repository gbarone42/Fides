
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activities</title>
    <script>
        const apiUrl = 'http://localhost:4000/activities';

        async function loadActivities() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                document.getElementById("loginSection").style.display = "block";
                document.getElementById("activitiesSection").style.display = "none";
                return;
            }
            const response = await fetch(apiUrl, {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            const activities = await response.json();
            const activityList = document.getElementById('activityList');
            activityList.innerHTML = '';
            activities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.innerHTML = `
                    <p>
                    <strong>Title:</strong> ${activity.title} <br />
                    <strong>Description:</strong> ${activity.description} <br />
                    <strong>Date:</strong> ${activity.date} <br />
                    <strong>User:</strong> ${activity.username} <br />
                    <button onclick="deleteActivity(${activity.id})">Delete</button>
                    </p>
                    <hr />
                `;
                activityList.appendChild(activityItem);
            });
        }

        async function deleteActivity(id) {
            const token = localStorage.getItem('jwtToken');
            const response = await fetch(apiUrl + '/' + id, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            if (response.ok) {
                loadActivities(); // Refresh the list after deletion
            } else {
                alert('Failed to delete activity');
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const response = await fetch('http://localhost:3000/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            });
            const data = await response.json();
            if (data.token) {
                localStorage.setItem('jwtToken', data.token);
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("activitiesSection").style.display = "block";
                loadActivities();
            } else {
                alert('Login failed');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                loadActivities();
            } else {
                document.getElementById("loginSection").style.display = "block";
                document.getElementById("activitiesSection").style.display = "none";
            }
        });
    </script>
</head>
<body>
    <div id="loginSection">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Username" />
        <input type="password" id="password" placeholder="Password" />
        <button onclick="login()">Login</button>
    </div>

    <div id="activitiesSection" style="display:none;">
        <h1>Activities</h1>
        <div id="activityList"></div>
    </div>
</body>
</html>
